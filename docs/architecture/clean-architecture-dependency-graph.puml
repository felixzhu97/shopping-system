@startuml Clean Architecture Dependency Graph
!theme plain
skinparam backgroundColor #FFFFFF
skinparam componentStyle rectangle

title 整洁架构依赖关系图

' 定义各层
rectangle "Presentation Layer\n(表示层)" as Presentation #LightBlue {
  component [Controllers] as Controllers
  component [Serializers] as Serializers
  component [Validators] as Validators
}

rectangle "Infrastructure Layer\n(基础设施层)" as Infrastructure #LightGreen {
  component [HTTP Server] as Server
  component [Repositories\nImplementation] as RepoImpl
  component [Database Models] as Models
  component [External Services] as ExternalServices
  component [Logger Implementation] as LoggerImpl
}

rectangle "Application Layer\n(应用层)" as Application #LightYellow {
  component [Use Cases] as UseCases
  component [DTOs] as DTOs
  component [Application Interfaces] as AppInterfaces
}

rectangle "Domain Layer\n(领域层)" as Domain #LightCoral {
  component [Entities] as Entities
  component [Value Objects] as ValueObjects
  component [Repository Interfaces] as RepoInterfaces
  component [Domain Services\nInterfaces] as DomainServices
  component [Domain Errors] as Errors
}

' 依赖关系（箭头指向被依赖的方向）
Presentation --> Application : depends on
Presentation --> Infrastructure : uses

Infrastructure --> Application : implements
Infrastructure --> Domain : implements interfaces

Application --> Domain : depends on

' 详细依赖
Controllers --> UseCases : calls
Controllers --> Serializers : uses
Controllers --> Validators : uses

UseCases --> RepoInterfaces : depends on
UseCases --> Entities : uses
UseCases --> ValueObjects : uses
UseCases --> DTOs : uses
UseCases --> AppInterfaces : uses

RepoImpl ..|> RepoInterfaces : implements
RepoImpl --> Models : uses
Models --> Entities : maps to

Server --> Controllers : routes to
Server --> Validators : validates

LoggerImpl ..|> AppInterfaces : implements

' 样式
note right of Domain
  最内层
  无外部依赖
  纯业务逻辑
end note

note right of Application
  依赖 Domain
  实现用例
  协调业务逻辑
end note

note right of Infrastructure
  最外层
  实现接口
  依赖框架
end note

note right of Presentation
  用户界面层
  格式化数据
  处理请求
end note

' 依赖规则标注
note bottom of Domain
  ⚠️ 依赖规则：依赖只能从外层指向内层
  ✅ Domain 不依赖任何其他层
  ✅ Application 只依赖 Domain
  ✅ Infrastructure 依赖 Application 和 Domain
  ✅ Presentation 依赖所有层
end note

@enduml

