@startuml
title TOGAF Application Architecture - Shopping System

skinparam componentStyle rectangle
skinparam packageStyle rectangle
skinparam linetype ortho

package "Web App (apps/web)" {
    component [Web App\nNext.js] as web_app
    component [UI Components\npackages/components] as web_ui_components
    component [State Store\nZustand] as web_state_store
    component [API Client\nfetch (Next.js)] as web_api_client
    component [API Proxy Route\nNext.js Route Handler] as web_api_proxy
}

package "Admin App (apps/admin)" {
    component [Admin App\nAngular] as admin_app
    component [Admin API Client\nAngular HttpClient] as admin_api_client
    component [Crawler Client\nAngular HttpClient] as admin_crawler_client
    component [3D Viewer\nThree.js] as admin_3d_viewer
    component [Meeting Client\nsocket.io-client] as admin_meeting_client
    component [MeetingService\nWebRTC] as admin_meeting_service
    component [Video Viewer\nvideo-src directive] as admin_video_viewer
}

package "Mobile App (apps/mobile)" {
    component [Mobile App\nExpo + React Native] as mobile_app
    component [Mobile API Client\nAxios] as mobile_api_client
    component [Mobile State Store\nZustand] as mobile_state_store
}

package "API Service (services/api)" {
    component [Express App\nExpress.js] as api_app
    component [Lambda Handler\nserverless-http] as api_lambda
    component [JWT Middleware\nexpress-jwt] as api_jwt
    component [Admin Auth Middleware\nadmin-secret] as api_admin_auth
    component [Routes\nproducts, cart, users, orders, recommendations] as api_routes
    component [Controllers\nTypeScript] as api_controllers
    component [Models\nMongoose] as api_models
    component [Payment Integration\npackages/payment-integration] as api_payment_pkg
}

package "Crawler Service (services/crawler)" {
    component [FastAPI App\nFastAPI] as crawler_api
    component [Job Store\nIn-memory] as crawler_store
    component [Crawler Engine\nhttpx + BeautifulSoup4] as crawler_engine
}

package "Crawler CLI (apps/crawler-cli)" {
    component [Crawler CLI\nNode.js] as crawler_cli
    component [HTML Parser\ncheerio] as crawler_cli_parser
}

package "Data Mining (services/data-mining)" {
    component [Offline Jobs\nPython scripts + notebooks] as data_mining
}

package "Meeting Signal Service (services/meeting-signal)" {
    component [Node.js HTTP Server] as meeting_http
    component [Socket.IO Server] as meeting_socketio
    component [In-memory Room Store] as meeting_room_store
}

package "Shared Packages (packages/*)" {
    component [Monitoring\npackages/monitoring] as pkg_monitoring
    component [Utils\npackages/utils] as pkg_utils
    component [Types\npackages/types] as pkg_types
    component [Auth\npackages/auth] as pkg_auth
}

package "Interfaces" {
    interface "REST API\nHTTPS" as rest_api
    interface "JWT Auth\nAuthorization: Bearer" as jwt_auth
    interface "WebSocket\nSocket.IO" as websocket
}

database "MongoDB\nAtlas or local" as mongodb
cloud "Datadog" as datadog
cloud "External Websites" as external_websites

web_app --> web_ui_components
web_app --> web_state_store
web_app --> web_api_client
web_app --> web_api_proxy
web_app --> pkg_types
web_app --> pkg_utils
web_app --> pkg_monitoring
web_app --> pkg_auth

admin_app --> admin_api_client
admin_app --> admin_crawler_client
admin_app --> admin_3d_viewer
admin_app --> admin_meeting_client
admin_app --> admin_meeting_service
admin_app --> admin_video_viewer
admin_app --> pkg_types

mobile_app --> mobile_api_client
mobile_app --> mobile_state_store
mobile_app --> pkg_types
mobile_app --> pkg_utils

web_api_client --> rest_api
web_api_client --> jwt_auth
web_api_proxy --> rest_api
admin_api_client --> rest_api
admin_api_client --> jwt_auth
mobile_api_client --> rest_api
mobile_api_client --> jwt_auth
rest_api --> api_app

api_app --> api_jwt
api_app --> api_admin_auth
api_app --> api_routes
api_routes --> api_controllers
api_controllers --> api_models
api_controllers --> api_payment_pkg
api_models --> mongodb
api_app --> api_lambda

admin_meeting_client --> websocket
admin_meeting_service --> admin_meeting_client
admin_video_viewer --> admin_meeting_service
websocket --> meeting_socketio
meeting_socketio --> meeting_http
meeting_socketio --> meeting_room_store

admin_crawler_client --> crawler_api
crawler_api --> crawler_store
crawler_api --> crawler_engine
crawler_engine --> external_websites

crawler_cli --> external_websites
crawler_cli --> crawler_cli_parser

data_mining --> mongodb

web_app --> datadog
api_app --> datadog
api_lambda --> datadog

@enduml