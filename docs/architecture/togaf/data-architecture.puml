@startuml
title TOGAF Data Architecture - Shopping System

skinparam componentStyle rectangle
skinparam packageStyle rectangle
skinparam databaseStyle rectangle
skinparam linetype ortho

package "Domain Entities" {
    database "User" as user
    database "Product" as product
    database "Order" as order
    database "Cart" as cart
    database "ScrapedProduct (crawler output)" as scraped_product
    database "CrawlJob (crawler runtime state)" as crawl_job
    database "Offline Dataset (export files)" as offline_dataset
}

user --> cart : 1:1
user --> order : 1:N
product --> order : N:M
product --> cart : N:M

database "MongoDB" as mongodb

package "MongoDB Collections" {
    component [users] as users_collection
    component [products] as products_collection
    component [orders] as orders_collection
    component [carts] as carts_collection
}

package "Data Access (services/api)" {
    component [Mongoose Models] as mongoose_models
    component [Schema Validation] as schema_validation
    component [Password Hashing (bcryptjs)] as password_hashing
}

package "Crawler Data (services/crawler)" {
    component [In-memory Job Store] as crawler_job_store
    component [Scrape Results] as crawler_results
}

package "Meeting Data (services/meeting-signal)" {
    component [Meeting Session (ephemeral)\nroom ID, user list, signaling cache] as meeting_session
}

package "Offline Data Mining (services/data-mining)" {
    component [Export Scripts] as export_scripts
    component [Training Scripts] as training_scripts
}

user --> users_collection
product --> products_collection
order --> orders_collection
cart --> carts_collection

users_collection --> mongodb
products_collection --> mongodb
orders_collection --> mongodb
carts_collection --> mongodb

mongoose_models --> users_collection
mongoose_models --> products_collection
mongoose_models --> orders_collection
mongoose_models --> carts_collection

mongoose_models --> schema_validation
mongoose_models --> password_hashing

crawler_job_store --> crawl_job
crawler_results --> scraped_product
scraped_product --> offline_dataset

export_scripts --> mongodb
export_scripts --> offline_dataset
training_scripts --> offline_dataset

@enduml